atomic_int x;
atomic_int y;
atomic_int z;

// Test similar to LB+Wd, i.e. load buffering
// plus a read from a distinct location and a write to this location in a separate thread.
// The difference is that in this test there is a dependency between
// the read and a write participating into the po-rf cycle.
// Thus the revisit generated by the third thread
// should fail to re-certify the po-rf cycle.

void *thread_one(void *arg) {
	int r1 = atomic_load_explicit(&x, memory_order_relaxed);
	if (r1 <= 1) {
		atomic_store_explicit(&y, 1, memory_order_relaxed);
	}
	return NULL;
}

void *thread_two(void *arg) {
	int r2 = atomic_load_explicit(&y, memory_order_relaxed);
	int r3 = atomic_load_explicit(&z, memory_order_relaxed);
	atomic_store_explicit(&x, r2 + r3, memory_order_relaxed);
	return NULL;
}

void *thread_three(void *arg) {
	atomic_store_explicit(&z, 1, memory_order_relaxed);
	return NULL;
}
